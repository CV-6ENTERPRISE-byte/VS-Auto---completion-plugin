using System;
using System.Runtime.InteropServices;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.VisualStudio.Shell;
using Microsoft.VisualStudio.Shell.Interop;
using EnvDTE;

namespace AIModDeveloper
{
    [PackageRegistration(UseManagedResourcesOnly = true, AllowsBackgroundLoading = true)]
    [InstalledProductRegistration("AI Mod Developer", "AI驱动的全自动Mod和网站插件开发工具", "1.0")]
    [ProvideToolWindow(typeof(AIModToolWindow))]
    [Guid("12345678-1234-1234-1234-123456789012")]
    public sealed class AIModHelperPackage : AsyncPackage
    {
        protected override async Task InitializeAsync(CancellationToken cancellationToken, IProgress<ServiceProgressData> progress)
        {
            await base.InitializeAsync(cancellationToken, progress);
            await JoinableTaskFactory.SwitchToMainThreadAsync(cancellationToken);
            
            await AIModCommand.InitializeAsync(this);
        }

        protected override WindowPane InstantiateToolWindow(Type toolWindowType)
        {
            if (toolWindowType == typeof(AIModToolWindow))
            {
                return new AIModToolWindow();
            }
            return base.InstantiateToolWindow(toolWindowType);
        }
    }
}
